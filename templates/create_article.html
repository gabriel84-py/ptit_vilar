<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Créer un article</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- ✅ EasyMDE (éditeur Markdown) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/easymde/dist/easymde.min.css"
    />
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

    <!-- CSS dédié à CETTE page -->
    <link rel="stylesheet" href="/static/create_article.css" />
    <link rel="stylesheet" href="/static/fixe_header.css" />
  </head>
  <body>
    <!-- Barre supérieure -->
    <header class="container header" role="banner">
      <a class="brand" href="/">Journal du lycée</a>

      <nav class="nav" aria-label="Navigation principale">
        <a
          class="nav-link {% if request.url.path == '/' %}is-active{% endif %}"
          href="/"
        >
          Accueil
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        <a
          class="nav-link {% if request.url.path.startswith('/categories') %}is-active{% endif %}"
          href="/categories"
        >
          Rubriques
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        {% if request.state.user %}
        <a
          class="nav-link {% if request.url.path.startswith('/admin') %}is-active{% endif %}"
          href="/admin"
        >
          Admin Panel
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        <a class="nav-link" href="/login/logout">
          Déconnexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% else %}
        <a
          class="nav-link {% if request.url.path.startswith('/login') %}is-active{% endif %}"
          href="/login"
        >
          Connexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% endif %}
      </nav>
    </header>

    <div class="inputcontainer">
      <h1>Créer un article</h1>

      <form
        action="/admin/articles/create"
        method="post"
        enctype="multipart/form-data"
      >
        <input type="text" name="title" placeholder="Titre" required />

        <input
          type="text"
          name="subtitle"
          maxlength="42"
          required
          oninput="this.value = this.value.slice(0, 42)"
          placeholder="Sous-titre (max 42 caractères)"
        />

        <label for="category">Catégorie :</label>
        <select name="category" id="category" required>
          <option value="">-- Choisir une catégorie --</option>
          <option value="Vie du lycée">Vie du lycée</option>
          <option value="Science et Progrès">Science et progrès</option>
          <option value="Culture et Arts">Culture et Arts</option>
          <option value="Sport">Sport</option>
          <option value="Un oeil sur le monde">Un oeil sur le monde</option>
          <option value="Autres">Autres</option>
          <option value="Orientation">Orientation</option>
        </select>

        <label for="content">Contenu de l’article :</label>
        <!-- ✅ Zone Markdown -->
        <textarea
          class="markdown-editor"
          id="markdown-editor"
          name="content"
        ></textarea>

        <label for="image">Image :</label>
        <input type="file" name="image" id="image" required />

        <button class="btn" type="submit">Créer</button>
      </form>

      <a class="back" href="/admin/articles">← Retour</a>
    </div>

    <footer class="container footer" role="contentinfo">
      <div>© Journal du lycée Jean VILAR — Tous droits réservés</div>
      <div class="by">© Made by Team LogicPulse</div>
    </footer>

    <!-- ✅ Script EasyMDE -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const easyMDE = new EasyMDE({
          element: document.getElementById("markdown-editor"),
          spellChecker: false,
          placeholder: "Rédigez votre article ici (Markdown pris en charge)…",
          toolbar: [
            "bold",
            "italic",
            "heading",
            "|",
            "quote",
            "unordered-list",
            "ordered-list",
            "|",
            "link",
            "image",
            "table",
            "|",
            "preview",
            "side-by-side",
            "fullscreen",
            "|",
            "guide",
          ],
        });

        const form = document.querySelector("form");
        form.addEventListener("submit", (event) => {
          // On récupère le texte depuis l’éditeur
          const content = easyMDE.value().trim();

          // Validation manuelle (remplace le required)
          if (!content) {
            alert("Le contenu de l’article ne peut pas être vide !");
            event.preventDefault();
            return;
          }

          // On copie la valeur dans le textarea caché
          document.querySelector("#markdown-editor").value = content;
        });
      });
    </script>
  </body>
</html>
