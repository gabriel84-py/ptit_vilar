<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Liste des utilisateurs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <!-- CSS dédié à CETTE page -->
    <link rel="stylesheet" href="/static/view_users.css" />
    <link rel="stylesheet" href="/static/fixe_header.css" />
  </head>
  <body>
    <!-- Barre supérieure -->
    <header class="container header" role="banner">
      <a class="brand" href="/">Journal du lycée</a>

      <nav class="nav" aria-label="Navigation principale">
        <a
          class="nav-link {% if request.url.path == '/' %}is-active{% endif %}"
          href="/"
        >
          Accueil
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        <a
          class="nav-link {% if request.url.path|startswith('/categories') %}is-active{% endif %}"
          href="/categories"
        >
          Rubriques
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        {% if request.state.user %}
        <a
          class="nav-link {% if request.url.path|startswith('/admin') %}is-active{% endif %}"
          href="/admin"
        >
          Admin Panel
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        <a class="nav-link" href="/login/logout">
          Déconnexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% else %}
        <a
          class="nav-link {% if request.url.path|startswith('/login') %}is-active{% endif %}"
          href="/login"
        >
          Connexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% endif %}
      </nav>
    </header>

    <!-- Barre mobile centrée -->
    <div class="mobile-topbar" role="region" aria-label="Menu mobile">
      <button
        class="nav-fab"
        aria-expanded="false"
        aria-controls="mobileMenu"
        aria-label="Ouvrir le menu"
      >
        <span class="hamb" aria-hidden="true">
          <span class="bar bar1"></span>
          <span class="bar bar2"></span>
          <span class="bar bar3"></span>
        </span>
      </button>
    </div>
    <!-- Menu déroulant mobile -->
    <div id="mobileMenu" class="mobile-drawer" hidden>
      <nav class="mobile-nav" aria-label="Navigation mobile">
        <a
          class="mobile-link"
          href="/"
          data-active="{{ '1' if request.url.path == '/' else '0' }}"
          >Accueil</a
        >
        <a
          class="mobile-link"
          href="/categories"
          data-active="{{ '1' if request.url.path|startswith('/categories') else '0' }}"
          >Rubriques</a
        >

        {% if request.state.user %}
        <a
          class="mobile-link"
          href="/admin"
          data-active="{{ '1' if request.url.path|startswith('/admin') else '0' }}"
          >Admin Panel</a
        >
        <a class="mobile-link" href="/login/logout">Déconnexion</a>
        {% else %}
        <a
          class="mobile-link"
          href="/login"
          data-active="{{ '1' if request.url.path|startswith('/login') else '0' }}"
          >Connexion</a
        >
        {% endif %}
      </nav>
    </div>

    <!-- Backdrop -->
    <div class="mobile-backdrop" hidden></div>

    <div class="tablecontainer">
      <div class="table-toolbar">
        <h1>Liste des utilisateurs</h1>
        <a href="/admin" class="back">← Retour au dashboard</a>
      </div>

      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width: 110px">ID</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td data-label="ID">#{{ user.id }}</td>
              <td data-label="Email">{{ user.email }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <footer class="container footer" role="contentinfo">
      <div>© Journal du lycée Jean VILAR — Tous droits réservés</div>
      <div class="by">© Made by Team LogicPulse</div>
    </footer>
  </body>
  <script>
    (function () {
      const fab = document.querySelector(".nav-fab");
      const drawer = document.getElementById("mobileMenu");
      const backdrop = document.querySelector(".mobile-backdrop");
      if (!fab || !drawer || !backdrop) return;

      function setOpen(isOpen) {
        fab.setAttribute("aria-expanded", String(isOpen));
        drawer.toggleAttribute("hidden", !isOpen);
        backdrop.toggleAttribute("hidden", !isOpen);
        drawer.setAttribute("data-open", String(isOpen));
        backdrop.setAttribute("data-open", String(isOpen));
        document.documentElement.style.overflow = isOpen ? "hidden" : "";
        if (isOpen) {
          const firstLink = drawer.querySelector("a");
          firstLink && firstLink.focus({ preventScroll: true });
        } else {
          fab.focus({ preventScroll: true });
        }
      }
      function toggle() {
        setOpen(fab.getAttribute("aria-expanded") !== "true");
      }

      fab.addEventListener("click", toggle);
      backdrop.addEventListener("click", () => setOpen(false));
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") setOpen(false);
      });

      // Sécurité: si on repasse en desktop, on ferme
      const mq = window.matchMedia("(min-width: 521px)");
      mq.addEventListener?.("change", () => setOpen(false));
    })();
  </script>
</html>
