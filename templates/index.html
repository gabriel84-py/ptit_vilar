<!--
====== Développé par TEAM LogicPulse ======
| YouTube :                               |
| Discord : https://discord.gg/efVfp5A89k |
| Instagram : @team_LogicPulse            |
===========================================
-->

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <!-- Responsive : viewport mobile/desktop -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Accueil — P'tit Vilar</title>

        <!-- Favicon standard -->
        <link rel="icon" type="image/png" sizes="32x32" href="/static/uploads/logoptitvilar3.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/static/uploads/logoptitvilar3.png">
    
        <!-- Pour iPhone / iPad (icône d’écran d’accueil) -->
        <link rel="apple-touch-icon" sizes="180x180" href="/static/uploads/logoptitvilar3.png">
    
          <!-- Manifest (Android, Chrome) -->
          <link rel="manifest" href="/static/uploads/logoptitvilar3.png">

    <!-- Police Inter (maquette) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- CSS dédié à CETTE page -->
    <link rel="stylesheet" href="/static/index.css" />
    <link rel="stylesheet" href="/static/fixe_header.css" />
  </head>

  <body>
    <!-- Barre supérieure -->
    <header class="container header" role="banner">
      <a class="brand" href="/">
        <img src="/static/uploads/logoptitvilar3.png" alt="Le P'tit Vilar" class="logo" width="100" height="100">
      </a>

      <nav class="nav" aria-label="Navigation principale">
        <a
          class="nav-link {% if request.url.path == '/' %}is-active{% endif %}"
          href="/"
        >
          Accueil
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        <a
          class="nav-link {% if request.url.path|startswith('/categories') %}is-active{% endif %}"
          href="/categories"
        >
          Rubriques
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>

        {% if request.state.user %}
        <a
          class="nav-link {% if request.url.path|startswith('/admin') %}is-active{% endif %}"
          href="/admin"
        >
          Admin Panel
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        <a class="nav-link" href="/login/logout">
          Déconnexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% else %}
        <a
          class="nav-link {% if request.url.path|startswith('/login') %}is-active{% endif %}"
          href="/login"
        >
          Connexion
          <svg
            class="nav-ring"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 100 40"
            preserveAspectRatio="none"
          >
            <path
              class="nav-ring__stroke"
              pathLength="100"
              d="M50,1.5 H78.5 A18.5,18.5 0 0 1 78.5,38.5 H21.5 A18.5,18.5 0 0 1 21.5,1.5 H50 Z"
            />
          </svg>
        </a>
        {% endif %}
      </nav>
    </header>

    <!-- Barre mobile centrée -->
    <div class="mobile-topbar" role="region" aria-label="Menu mobile">
      <button
        class="nav-fab"
        type="button"
        aria-expanded="false"
        aria-controls="mobileMenu"
        aria-label="Ouvrir le menu"
      >
        <span class="hamb" aria-hidden="true">
          <span class="bar bar1"></span>
          <span class="bar bar2"></span>
          <span class="bar bar3"></span>
        </span>
      </button>
    </div>
    <!-- Menu déroulant mobile -->
    <div id="mobileMenu" class="mobile-drawer" hidden>
      <nav class="mobile-nav" aria-label="Navigation mobile">
        <a
          class="mobile-link"
          href="/"
          data-active="{{ '1' if request.url.path == '/' else '0' }}"
          >Accueil</a
        >
        <a
          class="mobile-link"
          href="/categories"
          data-active="{{ '1' if request.url.path|startswith('/categories') else '0' }}"
          >Rubriques</a
        >

        {% if request.state.user %}
        <a
          class="mobile-link"
          href="/admin"
          data-active="{{ '1' if request.url.path|startswith('/admin') else '0' }}"
          >Admin Panel</a
        >
        <a class="mobile-link" href="/login/logout">Déconnexion</a>
        {% else %}
        <a
          class="mobile-link"
          href="/login"
          data-active="{{ '1' if request.url.path|startswith('/login') else '0' }}"
          >Connexion</a
        >
        {% endif %}
      </nav>
    </div>

    <!-- Backdrop -->
    <div class="mobile-backdrop" hidden></div>

    <main class="container main" role="main">
      <!-- HERO / À LA UNE -->
      {% if featuredArticle %}
      <article class="featured-card">
        <a href="/articles/{{ featuredArticle.id }}" class="featured-media">
          <img src="{{ featuredArticle.image_url }}" alt="{{ featuredArticle.title }}" />
          <span class="media-chip">À la une</span>
        </a>
        <div class="featured-body">
          <a class="chip"
            href="/categories?category={{ featuredArticle.category }}"
            data-category="{{ featuredArticle.category|lower|replace(' ', '-') }}">
            {{ featuredArticle.category }}
          </a>

          <h1 class="featured-h1">
            <a class="featured-title-link"
              href="/articles/{{ featuredArticle.id }}"
              aria-label="{{ featuredArticle.title }}">
              {{ featuredArticle.title }}
            </a>
          </h1>

          <h3 class="featured-h3">{{ featuredArticle.subtitle }}</h3>
          <div class="featured-content is-clamped" id="featured-content">
            {{ featuredArticle.content | markdown }}
          </div>
        </div>
      </article>
      {% endif %}


    <!-- DERNIERS ARTICLES -->
    <section class="latest" aria-labelledby="derniers-articles">
      <div class="container">
        <div class="section-head">
          <h2 id="derniers-articles">Derniers articles</h2>
          <a class="see-all" href="/categories">Tout voir</a>
        </div>

        <ul class="articles-grid">
          {% for article in articles|slice(0, 6) %}

          <li>
            <article class="card">
              <a
                class="card-media"
                href="/articles/{{ article.id }}"
                aria-label="Lire : {{ article.title }}"
              >
                <img
                  src="{{ article.image_url }}"
                  alt="{{ article.title }}"
                  loading="lazy"
                />
              </a>
              <div class="card-body">
                <h3 class="card-title">
                  <a href="/articles/{{ article.id }}">{{ article.title }}</a>
                </h3>
                <p class="card-excerpt">{{ article.subtitle }}</p>
                <p class="card-meta">
                  {{ article.created_at | strftime("%d/%m/%Y") }} •
                  <a
                    class="chip"
                    href="/categories?category={{ article.category }}"
                    data-category="{{ article.category|lower|replace(' ', '-') }}"
                  >
                    {{ article.category }}
                  </a>
                </p>
              </div>
            </article>
          </li>

          {% endfor %}
        </ul>
      </div>
    </section>

    <footer class="container footer" role="contentinfo">
      <div>© Journal du lycée Jean VILAR — Tous droits réservés</div>
      <div class="by">© Made by Team LogicPulse</div>
    </footer>
    <script>
      (function () {
        const fab = document.querySelector(".nav-fab");
        const drawer = document.getElementById("mobileMenu");
        const backdrop = document.querySelector(".mobile-backdrop");
        if (!fab || !drawer || !backdrop) return;

        function setOpen(isOpen) {
          fab.setAttribute("aria-expanded", String(isOpen));
          drawer.toggleAttribute("hidden", !isOpen);
          backdrop.toggleAttribute("hidden", !isOpen);
          drawer.setAttribute("data-open", String(isOpen));
          backdrop.setAttribute("data-open", String(isOpen));
          document.documentElement.style.overflow = isOpen ? "hidden" : "";
          if (isOpen) {
            const firstLink = drawer.querySelector("a");
            firstLink && firstLink.focus({ preventScroll: true });
          } else {
            fab.focus({ preventScroll: true });
          }
        }
        function toggle() {
          setOpen(fab.getAttribute("aria-expanded") !== "true");
        }

        fab.addEventListener("click", toggle);
        backdrop.addEventListener("click", () => setOpen(false));
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") setOpen(false);
        });

        // Sécurité: si on repasse en desktop, on ferme
        const mq = window.matchMedia("(min-width: 521px)");
        mq.addEventListener?.("change", () => setOpen(false));
      })();
    </script>
  </body>
</html>
