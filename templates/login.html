<!-- 
====== D√©velopp√© par TEAM LogicPulse ======
| YouTube :                               |
| Discord :                               |
| Instagram : @team_LogicPulse            |
===========================================  
-->

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <!-- Responsive : viewport mobile/desktop -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connexion ‚Äî Journal du lyc√©e</title>

    <!-- Police Inter (maquette) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>

  <!--
    CSS d√©di√© √† CETTE page.
    Contient :
    - layout (.shell, .media, .panel)
    - styles du carrousel (.frame, .slide, .caption, .dots)
    - styles du bouton "Retour au site" (.back-pill)
    - styles du formulaire (champs, bouton, liens)
  -->
  <link rel="stylesheet" href="/static/login.css" />

  <body>
    <main class="shell" role="main">
      <!-- =========================================
           COLONNE GAUCHE : CARROUSEL D'IMAGES
           ========================================= -->
      <section class="media">
        <!-- .frame cr√©e une carte interne (coins arrondis, bordure fine, ombre) -->
        <div class="frame">
          <!-- viewport = conteneur des slides -->
          <div class="viewport" id="carousel">
            {% set list_articles = (articles or []) %} {% set latest =
            (list_articles | sort(attribute='created_at', reverse=True))[:3] %}
            {% if latest and latest|length > 0 %} {% for article in latest %}
            <figure class="slide {% if loop.first %}active{% endif %}">
              <!-- Image NON cliquable -->
              <img
                src="{{ article.image_url }}"
                alt="{{ article.title }}"
                loading="{{ 'eager' if loop.first else 'lazy' }}"
                fetchpriority="{{ 'high' if loop.first else 'low' }}"
              />

              <div class="gradient-bottom"></div>

              <!-- Seul le TITRE est cliquable -->
              <figcaption class="caption">
                <a
                  href="/articles/{{ article.id }}"
                  aria-label="Lire : {{ article.title }}"
                  style="color: inherit; text-decoration: none"
                >
                  {{ article.title }}
                </a>
              </figcaption>
            </figure>
            {% endfor %} {% else %}
            <!-- Fallback statique si pas d‚Äôarticles -->
            <figure class="slide active">
              <img src="/static/photo.png" alt="Dune d√©sert au cr√©puscule" />
              <div class="gradient-bottom"></div>
              <figcaption class="caption">
                Capturer l'instant, cr√©er des souvenirs
              </figcaption>
            </figure>
            <figure class="slide">
              <img src="/static/hand.png" alt="Sport scolaire" />
              <div class="gradient-bottom"></div>
              <figcaption class="caption">
                Vie du lyc√©e, clubs & √©v√©nements
              </figcaption>
            </figure>
            <figure class="slide">
              <img src="/static/debat.png" alt="D√©bat √©cologie" />
              <div class="gradient-bottom"></div>
              <figcaption class="caption">
                Actus, d√©bats, reportages des √©l√®ves
              </figcaption>
            </figure>
            {% endif %}

            <div class="top-controls">
              <a
                class="back-pill"
                href="/"
                aria-label="Retour √† l‚Äôaccueil du site"
              >
                Retour au site <span class="arr">‚Üí</span>
              </a>
            </div>

            <div
              class="dots"
              id="dots"
              aria-label="Indicateurs du carrousel"
            ></div>
          </div>
        </div>
      </section>

      <!-- =========================================
           COLONNE DROITE : FORMULAIRE DE CONNEXION
           ========================================= -->
      <aside class="panel" aria-labelledby="login-title">
        <h1 id="login-title">Se connecter</h1>
        <p class="muted">Veuillez saisir vos identifiants pour continuer</p>

        <!--
          Important :
          - action="/login/check" c√¥t√© serveur
          - autocomplete="off" pour √©viter l'auto-fill agressif (optionnel)
        -->
        <form action="/login/check" method="post" autocomplete="off">
          <!-- Email -->
          <label class="field">
            <input type="email" name="email" placeholder="Email" required />
          </label>

          <!-- Mot de passe + ≈ìil pour afficher/masquer -->
          <label class="field">
            <input
              id="pwd"
              type="password"
              name="password"
              placeholder="Mot de passe"
              required
            />
            <!-- Le bouton ne soumet pas le formulaire (type="button") -->
            <button
              class="eye"
              type="button"
              id="togglePwd"
              aria-label="Afficher/masquer le mot de passe"
            >
              üëÅÔ∏è
            </button>
          </label>

          <!-- CTA -->
          <button class="primary" type="submit">Connexion</button>

          <!-- Liens auxiliaires -->
          <div class="links">
            <a href="/admin">D√©j√† connect√© ?</a>
          </div>
        </form>
      </aside>
    </main>

    <script>
      // ============================
      // Carrousel minimal (CSS + JS)
      // ============================

      // R√©cup√®re toutes les slides et le conteneur des indicateurs
      const slides = [...document.querySelectorAll(".slide")];
      const dotsWrap = document.getElementById("dots");

      slides.forEach((s, i) => {
        s.inert = i !== 0;
      });

      // Index de la slide affich√©e + timer pour l'auto-play
      let index = 0,
        timer;

      // Cr√©e les "tirets" (dots) et branche le clic pour naviguer
      function renderDots() {
        dotsWrap.innerHTML = slides
          .map(
            (_, i) => `<button class="dot${i === 0 ? " active" : ""}"></button>`
          )
          .join("");

        // Clic sur un dot => aller √† la slide correspondante
        [...dotsWrap.children].forEach((d, i) =>
          d.addEventListener("click", () => go(i))
        );
      }

      // Affiche la slide n¬∞i (avec wrap-around)
      function go(i) {
        slides[index].classList.remove("active");
        slides[index].setAttribute("aria-hidden", "true");
        slides[index].inert = true;

        dotsWrap.children[index].classList.remove("active");

        index = (i + slides.length) % slides.length;

        slides[index].classList.add("active");
        slides[index].setAttribute("aria-hidden", "false");
        slides[index].inert = false;

        dotsWrap.children[index].classList.add("active");

        // Relance l'auto-play apr√®s une interaction
        restart();
      }

      // Passe √† la slide suivante
      function next() {
        go(index + 1);
      }

      // Lance l'auto-play (toutes les 4,5s)
      function start() {
        timer = setInterval(next, 4500);
      }

      // Stoppe l'auto-play
      function stop() {
        clearInterval(timer);
      }

      // Red√©marre l'auto-play
      function restart() {
        stop();
        start();
      }

      // Initialisation
      renderDots();
      start();

      // Pause auto-play quand la souris survole les images
      document
        .getElementById("carousel")
        .addEventListener("pointerenter", stop);
      document
        .getElementById("carousel")
        .addEventListener("pointerleave", start);

      // ======================================
      // ≈íil : afficher/masquer le mot de passe
      // ======================================
      const togglePwd = document.getElementById("togglePwd");
      const pwd = document.getElementById("pwd");
      togglePwd.addEventListener("click", () => {
        pwd.type = pwd.type === "password" ? "text" : "password";
      });
    </script>
  </body>
</html>
